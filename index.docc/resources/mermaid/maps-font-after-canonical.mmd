%% file: maps-font-after-canonical.svg
%% title: After - Canonical typography pipeline + shims
flowchart TB
  subgraph CANON[Canonical typography pipeline]
    T[Typography Tokens - titleMedium, bodySmall]
    FP[FontProvider - token to font descriptor]
    DT[Dynamic Type Scaler - content size category]
    OUT[UIFont / attributed output]
    T --> FP --> DT --> OUT
  end

  subgraph DIRECT[Direct usage - new code]
    F[Feature screens / controllers / views]
    F -->|direct use of tokens| T
  end

  subgraph INDIRECT[Indirect usage - via dependencies]
    C[Reusable UI components]
    S[Style builders]
    C -->|component uses tokens| T
    S -->|builder uses tokens| T
    F -->|uses components/builders| C
    F -->|uses components/builders| S
  end

  subgraph SHIMS[Temporary shims for legacy API families]
    SA[Shim A: direct UIFont calls to tokens]
    SB[Shim B: legacy helper to tokens]
    SC[Shim C: wrapper v1 to tokens]
    SD[Shim D: feature extensions to tokens]
    SE[Shim E: hard-coded detection to mapping]
  end

  LEGACY[Legacy call sites + legacy deps] --> SA
  LEGACY --> SB
  LEGACY --> SC
  LEGACY --> SD
  LEGACY --> SE

  SA --> T
  SB --> T
  SC --> T
  SD --> T
  SE --> T
